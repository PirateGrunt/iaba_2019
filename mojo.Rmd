```{r include = FALSE}
library(ncaahoopR)
load(file = 'ncaa.rda')
```

```{r}
my_void <- theme_void() +
  theme(
    text = element_text(size = 20)
    , legend.position = 'none'
  )

my_minimal <- theme_minimal() +
  theme(text = element_text(size = 20))
```

### Which of these two numbers is larger?

```{r}
tibble(
    size = c('', '11', '9', '')
  , x = c(0.5, 1, 3, 3.5)
  , y = 1
) %>% 
  ggplot(
    aes(x, y, label = size)
  ) + 
  geom_text(size = 52) +
  my_void
```


### How about these two?

```{r fig.width = 12, fig.height = 6}
tibble(
    size = c('', '1011', '1001', '')
  , x = c(0.5, 1, 3, 3.5)
  , y = 1
) %>% 
  ggplot(
    aes(x, y, label = size)
  ) + 
  geom_text(size = 44) +
  my_void
```

### And these?

```{r fig.width = 12, fig.height = 6}
tibble(
    size = c('', 'IX', 'XI', '')
  , x = c(1:4)
  , y = 1
) %>% 
  ggplot(
    aes(x, y, label = size)
  ) + 
  geom_text(size = 54) +
  my_void
```

### How about these?

```{r}
tibble(
    val = c('left', 'right')
  , size = c(11, 9)
) %>% 
  ggplot(
    aes(val, size)
  ) + 
  geom_bar(position = 'dodge', stat = 'identity') + 
  my_void
```

### 

```{r}
tibble(
    message = '9 != nine'
  , x = 1
  , y = 1
) %>% 
  ggplot(
    aes(x, y, label = message)
  ) + 
  geom_text(size = 54) +
  my_void
```

### Which is rarer?

```{r }
tibble(
    size = c('', '1 in 10', '1 in 100', '')
  , x = c(1,1,1,1)
  , y = c(2.5, 2, 1, 0.5)
) %>% 
  ggplot(
    aes(x, y, label = size)
  ) + 
  geom_text(size = 32) +
  my_void
```

### Which is rarer?

```{r }
library(gridExtra)

tbl_rare <- expand.grid(
    x = seq_len(50)
  , y = seq_len(20)
) %>% 
  mutate(
      rare_ten = TRUE
    , rare_hundred = TRUE
    , rare_thousand = TRUE
  )

tbl_rare$rare_ten[sample(1e3, 100)] <- FALSE
tbl_rare$rare_hundred[sample(1e3, 10)] <- FALSE
tbl_rare$rare_thousand[sample(1e3, 1)] <- FALSE

plt_ten <- tbl_rare %>% 
  ggplot(aes(x, y, fill = rare_ten)) + 
  geom_raster() +
  my_void +
  scale_fill_viridis_d()

plt_hundred <- tbl_rare %>% 
  ggplot(aes(x, y, fill = rare_hundred)) + 
  geom_raster() +
  my_void +
  scale_fill_viridis_d()

plt_thousand <- tbl_rare %>% 
  ggplot(aes(x, y, fill = rare_thousand)) + 
  geom_raster() +
  my_void +
  scale_fill_viridis_d()

gridExtra::grid.arrange(
    plt_ten
  , plt_hundred
)
```

### Now?

```{r}
gridExtra::grid.arrange(
    plt_ten
  , plt_hundred
  , plt_thousand
)

```

### Symbols

```{r}
tibble(
    size = c('', '1,000', '100', '10', '')
  , x = c(1, 1, 1, 1, 1)
  , y = c(3.5, 3, 2, 1, 0.5)
) %>% 
  ggplot(
    aes(x, y, label = size)
  ) + 
  geom_text(size = 24) +
  my_void
```

##

```{r}
gridExtra::grid.arrange(
    plt_ten
  , plt_hundred
  , plt_thousand
)
```

## Information density

### This is actually _too much_ information

```{r}
tibble(
    val = c('left', 'right')
  , size = c(11, 9)
) %>% 
  ggplot(
    aes(val, size)
  ) + 
  geom_bar(position = 'dodge', stat = 'identity') + 
  my_void
```

### This is better

```{r fig.width=4}
tibble(
    val = c('left', 'right')
  , size = c(11, 9)
) %>% 
  ggplot(
    aes(val, size)
  ) + 
  geom_bar(position = 'dodge', stat = 'identity', width = 0.1) + 
  my_void
```


### Sparse information

```{r}
tbl_shot_box <- tribble(
    ~Region, ~Period, ~Revenue
  , 'West', '1', 45
  , 'East', '1', 50
  , 'West', '2', 48
  , 'East', '2', 43
  , 'West', '3', 10
  , 'East', '3', 11
) %>% 
  group_by(Region) %>% 
  arrange(Period, .by_group = TRUE) %>% 
  mutate(Revenue = cumsum(Revenue)) %>% 
  ungroup()
```

Questions

1. Which region has performed better YTD?
2. How close is it?

```{r }
tbl_shot_box %>% 
  spread(Period, Revenue) %>% 
  knitr::kable()
```

<!--

##

```{r}
tbl_shot_box %>% 
  ggplot(aes(Period, Revenue, group = Region, color = Region)) +
  geom_line() + 
  scale_y_continuous(breaks = NULL) +
  my_minimal
```

-->

### The most exciting game in history?

```{r }
tbl_shot_box %>% 
  mutate(
      Period = case_when(Period == '3' ~ 'OT', TRUE ~ Period)
    , Region = case_when(Region == 'East' ~ 'Duke', TRUE ~ 'Kentucky')
  ) %>% 
  rename(Team = Region, Score = Revenue) %>% 
  spread(Period, Score) %>% 
  knitr::kable()
```

### Another exciting game

```{r}
tbl_shot_box_fsu <- tribble(
    ~Team, ~Period, ~Score
  , 'FSU', '1', 30
  , 'LSU', '1', 29
  , 'FSU', '2', 38
  , 'LSU', '2', 39
  , 'FSU', 'OT', 11
  , 'LSU', 'OT', 8
) %>% 
  group_by(Team) %>% 
  arrange(Period, .by_group = TRUE) %>% 
  mutate(Score = cumsum(Score)) %>% 
  ungroup()

tbl_shot_box_fsu %>% 
  spread(Period, Score) %>% 
  knitr::kable()
```


### We know

* Who won the game
* What the scores were at the end of each period
* That it was close (because it went into overtime)

### What we don't know

* How many lead changes there were
* How far ahead either team was 
* Occurrence of scoring runs/droughts

::: notes


Visualization has a high density of information
:::


### Play by play

```{r include = FALSE}
plt_fsu_lsu <- ncaahoopR::game_flow(game_fsu_lsu, fsu_color, lsu_color)
```

```{r }
plt_fsu_lsu
```

### Tabular data struggles with details

```{r}
tbl_pbp_fsu_lsu %>% 
  select(secs_remaining_absolute, home_score, away_score) %>% 
  knitr::kable()
```

## And another 300 rows!

### PBP

```{r}
plt_fsu_lsu
```

### Other items we could add

* Timing of fouls
* Solid vs. broken line for FG vs FT
* Time outs

## Focus on score changes

##

```{r }
tbl_pbp_fsu_lsu %>% 
  ggplot(aes(elapsed, score_diff)) +
  geom_line() + 
  geom_hline(yintercept = 0, color = 'black') + 
  my_minimal
```

## 

```{r }
tbl_ties <- tbl_pbp_fsu_lsu %>% 
  filter(tie) %>% 
  arrange(desc(secs_remaining_absolute)) %>% 
  mutate(
    total_score = home_score + away_score
    , score_change = coalesce(
        total_score != dplyr::lag(total_score)
        , TRUE)
  ) %>% 
  filter(
    score_change
  ) %>% 
  select(elapsed, score_diff)

tbl_pbp_fsu_lsu %>% 
  ggplot(aes(elapsed, score_diff)) +
  geom_line() + 
  geom_hline(yintercept = 0, color = 'black') + 
  geom_point(data = tbl_ties, color = 'red', size = 3) + 
  my_minimal
```

### More density

```{r}
tbl_fsu_pbp %>% 
  ggplot(aes(elapsed, score_diff, group = game_id)) +
    geom_line(aes(color = opponent)) + 
    geom_hline(yintercept = 0, color = 'black') + 
  my_minimal
```
